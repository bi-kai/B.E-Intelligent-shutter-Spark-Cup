C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE º__ÎEEPROM__“∂¥__€_____Ú
OBJECT MODULE PLACED IN º”»Îeeprom∞Ÿ“∂¥∞◊€∫œ≥Ã–Ú.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE º”»Îeeprom∞Ÿ“∂¥∞◊€∫œ≥Ã–Ú.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          #include < reg51.h >
   2          #include < intrins.h >
   3          
   4          #define ENABLE_ISP 0x80 //EEPROM≤Ÿ◊˜≤Œ ˝…Ë÷√£∫œµÕ≥π§◊˜ ±÷”<40MHz  ±£¨∂‘IAP_CONTR ºƒ¥Ê∆˜…Ë÷√¥À÷µ
   5          
   6          
   7          #define uchar unsigned char
   8          #define uint  unsigned int
   9          
  10          sbit PT2272_Data0=P2^0;
  11          sbit PT2272_Data1=P2^1;
  12          sbit PT2272_Data2=P2^2;
  13          sbit PT2272_Data3=P2^3;
  14          
  15          /******************************************/
  16          
  17          //ADC0832µƒ“˝Ω≈
  18          sbit AD2_CS =P1^4;  //ADC0832 chip seclect
  19          sbit AD2_DI =P3^4;  //ADC0832 k in
  20          sbit AD2_DO =P3^4;  //ADC0832 k out
  21          sbit AD2_CLK=P1^5; //ADC0832 clock signal
  22          sbit LED2_=P0^5;
  23          //ADC0832µƒ“˝Ω≈
  24          sbit AD1_CS =P3^5;  //ADC0832 chip seclect
  25          sbit AD1_DI =P3^7;  //ADC0832 k in
  26          sbit AD1_DO =P3^7;  //ADC0832 k out
  27          sbit AD1_CLK=P3^6; //ADC0832 clock signal
  28          sbit LED1_=P0^6;
  29          
  30          sbit Speaker=P1^7;
  31          sbit P3_2=P3^2;
  32          
  33          sbit LED4_=P0^7;  //◊‘∂Øµ˜Ω⁄÷∏ æµ∆
  34          sbit LED5_=P2^7;  //◊‘∂Øµ˜Ω⁄÷∏ æµ∆
  35          
  36          sbit LED6_=P0^0;  //ÕÍ»´¥Úø™÷∏ æµ∆
  37          sbit LED7_=P0^1;  //ÕÍ»´πÿ±’÷∏ æµ∆
  38          
  39          int meanvalue1;
  40          int meanvalue2; 
  41          
  42          char eeprom_meanvalue1;
  43          char eeprom_meanvalue2;
  44          char eeprom_meanvalue3;
  45          
  46          unsigned char data  temp_data1_[2] = {0x00,0x00} ;
  47          unsigned char data  display1_[5] =   {0x00,0x00,0x00,0x00,0x00} ;
  48          unsigned char data  temp_data2_[2] = {0x00,0x00} ;
  49          unsigned char data  display2_[5] =   {0x00,0x00,0x00,0x00,0x00} ;
  50          unsigned char code  ditab[16] =    {0x00,0x01,0x01,0x02,0x03,0x03,0x04,0x04,
  51                                                                  0x05,0x06,0x06,0x07,0x08,0x08,0x09,0x09} ;/*–° ˝Œª
             -±Ì£¨Àƒ…·ŒÂ»Î*/
  52          
  53          
  54          /******************∂® ±π¶ƒ‹≤ø∑÷************************/
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 2   

  55          
  56          uchar T1_h,T1_m,T1_s,T1_counter;
  57          
  58           /**************************************************************/
  59           /**********************eepromº”»Îµƒµ⁄“ª≤ø∑÷********************/
  60           /**************************************************************/
  61          
  62          uchar Cleaner=0;
  63          uint Mainaddress;
  64          uchar Model4_WTemprature[3];
  65          bit Model4_SendFlag=0;          //Œ™0‘ –Ì∑¢ÀÕ£¨Œ™1≤ª‘ –Ì∑¢ÀÕ£®±Í÷æŒª£©
  66          uchar allow_erase=0;
  67          bit allow_eraser=0;
  68          bit Model4_SendFlag1=0;
  69          uchar Model4_STemprature[4];
  70          uint Model4_SendData_Counter=0x2000;
  71          uint Model4_Eeprom_Counter=0x2000;
  72          
  73           /**************************************************************/
  74          
  75          sfr IAP_DATA    = 0xe2;
  76          sfr IAP_ADDRH   = 0xe3;
  77          sfr IAP_ADDRL   = 0xe4;
  78          sfr IAP_CMD     = 0xe5;
  79          sfr IAP_TRIG    = 0xe6;
  80          sfr IAP_CONTR   = 0xe7;
  81          //∂®“ÂFlash ≤Ÿ◊˜µ»¥˝ ±º‰º∞‘ –ÌIAP/ISP/EEPROM ≤Ÿ◊˜µƒ≥£ ˝
  82          
  83          union union_temp16{unsigned int un_temp16;unsigned char un_temp8[2];}my_unTemp16;
  84          
  85          
  86          unsigned char EEPROM_read(unsigned int add);   //∂¡“ª◊÷Ω⁄£¨µ˜”√«∞–Ë¥Úø™IAP π¶ƒ‹
  87          void EEPROM_write(unsigned int, unsigned char ch); //◊÷Ω⁄±‡≥Ã£¨µ˜”√«∞–Ë¥Úø™IAP π¶ƒ‹
  88          void EEPROM_erase(unsigned int add);            //≤¡≥˝…»«¯
  89          void EEPROM_IAP_Disable();                       //πÿ±’IAP π¶ƒ‹
  90          
  91          //void save_data_to_EEPROM(unsigned char num);
  92          
  93          void send(unsigned char str[]);
  94          
  95          
  96          
  97          /**************************************************************/
  98          /**************************************************************/
  99          /**************************************************************/
 100          /**************************************************************/
 101          
 102          
 103          void T1_init()
 104          {
 105   1      
 106   1        TMOD=0x21;
 107   1      // TH1=0xE8;
 108   1      // TL1=0xE8;
 109   1        EA=1;
 110   1      //ET1=1;
 111   1      // TR1=1;
 112   1        T1_counter=0;
 113   1        T1_h=12;T1_m=0;T1_s=0;
 114   1      
 115   1      }
 116          
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 3   

 117          /******************************************/
 118          
 119          bit SignalControl_Flag1=1;              //¡¨∂Ø±Í÷æŒª
 120          bit SignalControl_Flag2=1;              //Ωˆ‘ –Ìµ˜”√“ª¥ŒµÁª˙≥Ã–Ú±Í÷æŒª
 121          bit SelfControl_Flag=0;         //◊‘∂Øøÿ÷∆±Í÷æŒª
 122          bit Check_ForOnce=1;            //√ø¥Œ∞¥º¸÷–∂œ∫Û÷ª‘ –Ì∂Àø⁄…®√Ë“ª¥Œ
 123          bit Base_Flag=0;                        //≈–∂œ ±º‰ «∑Ò‘⁄‘ –Ì∑∂Œß÷Æƒ⁄±Í÷æŒª
 124          
 125          char INT1_Counter=0;
 126          //char Motor_StepCounter=0;
 127          
 128          void Motor_CompSlowlyUp(void);
 129          void Motor_CompSlowlyDown(void);
 130          void MainModel2(void);
 131          void MainModel1(void);
 132          void Motor_OpenUp(void);
 133          void Motor_CloseDown(void);
 134          int Motor_StepCounter=45;
 135          
 136          
 137          void delay1(int ms)//—”≥Ÿ∫Ø ˝
 138          
 139          { unsigned char y ;
 140   1        while(ms--)
 141   1        {
 142   2        for(y = 0 ; y<250 ; y++)
 143   2        {
 144   3         _nop_() ;
 145   3         _nop_() ;
 146   3         _nop_() ;
 147   3         _nop_() ;
 148   3        }
 149   2        }
 150   1       }
 151          
 152          
 153           /*************************º”»ÎµÁª˙1***************************/
 154          
 155          sbit P1_0=P1^0;
 156          sbit P1_1=P1^1;
 157          sbit P1_2=P1^2;
 158          sbit P1_3=P1^3;
 159          
 160          static unsigned int count; //º∆ ˝
 161          static int step_index; //≤ΩΩ¯À˜“˝ ˝£¨÷µŒ™0£≠7
 162          
 163          char i,j;
 164          char HadBeenDone;
 165          
 166          static bit turn; //≤ΩΩ¯µÁª˙◊™∂Ø∑ΩœÚ
 167          static bit stop_flag; //≤ΩΩ¯µÁª˙Õ£÷π±Í÷æ
 168          static int speedlevel; //≤ΩΩ¯µÁª˙◊™ÀŸ≤Œ ˝£¨ ˝÷µ‘Ω¥ÛÀŸ∂»‘Ω¬˝£¨◊Ó–°÷µŒ™1£¨ÀŸ∂»◊ÓøÏ
 169          static int spcount;    //≤ΩΩ¯µÁª˙◊™ÀŸ≤Œ ˝º∆ ˝
 170          void delay(unsigned int endcount); //—” ±∫Ø ˝£¨—” ±Œ™endcount*0.5∫¡√Î
 171          void gorun();          //≤ΩΩ¯µÁª˙øÿ÷∆≤ΩΩ¯∫Ø ˝
 172          
 173          
 174          
 175          
 176           /***************************************º”»Î¡Ω∏ˆAD◊€∫œ≤ø∑÷µƒ≥Ã–Ú*****************************************
             -***************************/
 177          /*********************************************************************************************************
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 4   

             -***************************/
 178          /*********************************************************************************************************
             -***************************/
 179          /*********************************************************************************************************
             -***************************/
 180          /*********************************************************************************************************
             -***************************/
 181          
 182          unsigned int Adc1_0832()     //AD◊™ªª£¨∑µªÿΩ·π˚
 183          {
 184   1          uchar i=0;
 185   1          uchar j;
 186   1          uint dat=0;
 187   1          uchar ndat=0;
 188   1          AD1_DI=1;
 189   1          _nop_();
 190   1          _nop_();
 191   1          AD1_CS=0;//¿≠µÕCS∂À
 192   1          _nop_();
 193   1          _nop_();
 194   1          AD1_CLK=1;//¿≠∏ﬂCLK∂À
 195   1          _nop_();
 196   1          _nop_();
 197   1          AD1_CLK=0;//¿≠µÕCLK∂À,–Œ≥…œ¬Ωµ—ÿ1
 198   1          _nop_();
 199   1          _nop_();
 200   1          AD1_CLK=1;//¿≠∏ﬂCLK∂À
 201   1          AD1_DI=0;   //Õ®µ¿0
 202   1          _nop_();
 203   1          _nop_();
 204   1          AD1_CLK=0;//¿≠µÕCLK∂À,–Œ≥…œ¬Ωµ—ÿ2
 205   1          _nop_();
 206   1          _nop_();
 207   1          AD1_CLK=1;//¿≠∏ﬂCLK∂À
 208   1          AD1_DI=1;//—°Õ®µ¿   1
 209   1          _nop_();
 210   1          _nop_();
 211   1          AD1_CLK=0;//¿≠µÕCLK∂À,–Œ≥…œ¬Ωµ—ÿ3
 212   1          AD1_DI=1;//øÿ÷∆√¸¡ÓΩ· ¯ 
 213   1          _nop_();
 214   1          _nop_();
 215   1          dat=0;
 216   1          for(i=0;i<8;i++)
 217   1          {
 218   2              dat|=AD1_DO;// ’ ˝æ›
 219   2              AD1_CLK=1;
 220   2              _nop_();
 221   2              _nop_();
 222   2              AD1_CLK=0;//–Œ≥…“ª¥Œ ±÷”¬ˆ≥Â
 223   2              _nop_();
 224   2              _nop_();
 225   2              dat<<=1;
 226   2              if(i==7)dat|=AD1_DO;
 227   2          }  
 228   1          for(i=0;i<8;i++)
 229   1          {
 230   2              j=0;
 231   2              j=j|AD1_DO;// ’ ˝æ›
 232   2              AD1_CLK=1;
 233   2              _nop_();
 234   2              _nop_();
 235   2              AD1_CLK=0;//–Œ≥…“ª¥Œ ±÷”¬ˆ≥Â
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 5   

 236   2              _nop_();
 237   2              _nop_();
 238   2              j=j<<7;
 239   2              ndat=ndat|j;
 240   2              if(i<7)ndat>>=1;
 241   2          }
 242   1          AD1_CS=1;//¿≠µÕCS∂À
 243   1          AD1_CLK=0;//¿≠µÕCLK∂À
 244   1          AD1_DO=1;//¿≠∏ﬂ ˝æ›∂À,ªÿµΩ≥ı º◊¥Ã¨
 245   1          dat<<=8;
 246   1          dat|=ndat;
 247   1          return(dat);            //return dat
 248   1      }
 249          /************************************************************/
 250          
 251           unsigned int Adc2_0832()     //AD◊™ªª£¨∑µªÿΩ·π˚
 252          {
 253   1          uchar i=0;
 254   1          uchar j;
 255   1          uint dat=0;
 256   1          uchar ndat=0;
 257   1          AD2_DI=1;
 258   1          _nop_();
 259   1          _nop_();
 260   1          AD2_CS=0;//¿≠µÕCS∂À
 261   1          _nop_();
 262   1          _nop_();
 263   1          AD2_CLK=1;//¿≠∏ﬂCLK∂À
 264   1          _nop_();
 265   1          _nop_();
 266   1          AD2_CLK=0;//¿≠µÕCLK∂À,–Œ≥…œ¬Ωµ—ÿ1
 267   1          _nop_();
 268   1          _nop_();
 269   1          AD2_CLK=1;//¿≠∏ﬂCLK∂À
 270   1          AD2_DI=0;   //Õ®µ¿0
 271   1          _nop_();
 272   1          _nop_();
 273   1          AD2_CLK=0;//¿≠µÕCLK∂À,–Œ≥…œ¬Ωµ—ÿ2
 274   1          _nop_();
 275   1          _nop_();
 276   1          AD2_CLK=1;//¿≠∏ﬂCLK∂À
 277   1          AD2_DI=1;//—°Õ®µ¿   1
 278   1          _nop_();
 279   1          _nop_();
 280   1          AD2_CLK=0;//¿≠µÕCLK∂À,–Œ≥…œ¬Ωµ—ÿ3
 281   1          AD2_DI=1;//øÿ÷∆√¸¡ÓΩ· ¯ 
 282   1          _nop_();
 283   1          _nop_();
 284   1          dat=0;
 285   1          for(i=0;i<8;i++)
 286   1          {
 287   2              dat|=AD2_DO;// ’ ˝æ›
 288   2              AD2_CLK=1;
 289   2              _nop_();
 290   2              _nop_();
 291   2              AD2_CLK=0;//–Œ≥…“ª¥Œ ±÷”¬ˆ≥Â
 292   2              _nop_();
 293   2              _nop_();
 294   2              dat<<=1;
 295   2              if(i==7)dat|=AD2_DO;
 296   2          }  
 297   1          for(i=0;i<8;i++)
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 6   

 298   1          {
 299   2              j=0;
 300   2              j=j|AD2_DO;// ’ ˝æ›
 301   2              AD2_CLK=1;
 302   2              _nop_();
 303   2              _nop_();
 304   2              AD2_CLK=0;//–Œ≥…“ª¥Œ ±÷”¬ˆ≥Â
 305   2              _nop_();
 306   2              _nop_();
 307   2              j=j<<7;
 308   2              ndat=ndat|j;
 309   2              if(i<7)ndat>>=1;
 310   2          }
 311   1          AD2_CS=1;//¿≠µÕCS∂À
 312   1          AD2_CLK=0;//¿≠µÕCLK∂À
 313   1          AD2_DO=1;//¿≠∏ﬂ ˝æ›∂À,ªÿµΩ≥ı º◊¥Ã¨
 314   1          dat<<=8;
 315   1          dat|=ndat;
 316   1          return(dat);            //return dat
 317   1      }
 318          
 319          /*                                                               ∂¡»° ˝æ›                         */  
 320          /*******************************************************************/     
 321          adc1_display(void) {
 322   1      
 323   1              LED1_=~LED1_;delay1(50);LED1_=~LED1_;delay1(50);LED1_=~LED1_;
 324   1      
 325   1           temp_data1_[0] =  Adc1_0832();   // ˝æ›µÕ8Œª
 326   1      
 327   1      
 328   1      /*  ˝æ›◊™ªª”ÎŒ¬∂»œ‘ æ                                              */
 329   1      /*******************************************************************/
 330   1        
 331   1        display1_[4]=(temp_data1_[0]&0x0f) ;  //ªªÀ„≥…8Œª∂˛Ω¯÷∆
 332   1        display1_[0]=ditab[display1_[4]]+0x30 ;     //≤È±Ìµ√–° ˝Œªµƒ÷µ
 333   1      
 334   1        display1_[4]=((temp_data1_[0]&0xf0)>>4)|((temp_data1_[1]&0x0f)<<4) ;
 335   1        display1_[3]=display1_[4]/100+0x30 ;
 336   1        display1_[1]=display1_[4]%100 ;
 337   1        display1_[2]=display1_[1]/10+0x30 ;
 338   1        display1_[1]=display1_[1]%10+0x30 ;    
 339   1      
 340   1                }
 341          
 342          
 343          
 344          
 345          
 346          
 347          
 348          adc2_display(void) {
 349   1      
 350   1                      LED2_=~LED2_;delay1(50);LED2_=~LED2_;delay1(50);LED2_=~LED2_;
 351   1              
 352   1           temp_data2_[0] =  Adc2_0832();   // ˝æ›µÕ8Œª
 353   1      
 354   1      
 355   1      /*                                                       ˝æ›◊™ªª                        */
 356   1      /*******************************************************************/
 357   1        
 358   1        display2_[4]=(temp_data2_[0]&0x0f) ;  //ªªÀ„≥…8Œª∂˛Ω¯÷∆
 359   1        display2_[0]=ditab[display2_[4]]+0x30 ;     //≤È±Ìµ√–° ˝Œªµƒ÷µ
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 7   

 360   1      
 361   1        display2_[4]=((temp_data2_[0]&0xf0)>>4)|((temp_data2_[1]&0x0f)<<4) ;
 362   1        display2_[3]=display2_[4]/100+0x30 ;
 363   1        display2_[1]=display2_[4]%100 ;
 364   1        display2_[2]=display2_[1]/10+0x30 ;
 365   1        display2_[1]=display2_[1]%10+0x30 ;      
 366   1         
 367   1                }
 368          
 369          /**************************************************************/
 370          /**********************eepromº”»Îµƒµ⁄∂˛≤ø∑÷*********************/
 371          /**************************************************************/
 372          /**************************************************************/
 373          
 374          
 375          unsigned char EEPROM_read(unsigned int add)      //∂¡“ª◊÷Ω⁄£¨µ˜”√«∞–Ë¥Úø™IAP π¶ƒ‹£¨»Îø⁄:DPTR = ◊÷Ω⁄µÿ÷∑£¨∑µªÿ:
             -A = ∂¡≥ˆ◊÷Ω⁄
 376          {
 377   1          IAP_DATA = 0x00;
 378   1          IAP_CMD = 0x01;                 //IAP/ISP/EEPROM ◊÷Ω⁄∂¡√¸¡Ó
 379   1          my_unTemp16.un_temp16 = add;
 380   1          IAP_ADDRH = my_unTemp16.un_temp8[0];    //…Ë÷√ƒø±Íµ•‘™µÿ÷∑µƒ∏ﬂ8 Œªµÿ÷∑
 381   1          IAP_ADDRL = my_unTemp16.un_temp8[1];    //…Ë÷√ƒø±Íµ•‘™µÿ÷∑µƒµÕ8 Œªµÿ÷∑
 382   1          //EA = 0;
 383   1          IAP_TRIG = 0x46;   //   46???   œ»ÀÕ 5Ah,‘ŸÀÕA5h µΩISP/IAP ¥•∑¢ºƒ¥Ê∆˜,√ø¥Œ∂º–Ë»Á¥À
 384   1          IAP_TRIG = 0xB9;   //   B9???   ÀÕÕÍA5h ∫Û£¨ISP/IAP √¸¡Ó¡¢º¥±ª¥•∑¢∆∂Ø
 385   1          _nop_();
 386   1          //EA = 1;
 387   1          return (IAP_DATA);
 388   1      }
 389          
 390          
 391          void EEPROM_write(unsigned int add, unsigned char ch) //◊÷Ω⁄±‡≥Ã£¨µ˜”√«∞–Ë¥Úø™IAP π¶ƒ‹£¨»Îø⁄:DPTR = ◊÷Ω⁄µÿ
             -÷∑, A= –Î±‡≥Ã◊÷Ω⁄µƒ ˝æ›
 392          {
 393   1          IAP_CMD = 0x02;                 //IAP/ISP/EEPROM ◊÷Ω⁄±‡≥Ã√¸¡Ó
 394   1          my_unTemp16.un_temp16 = add;
 395   1              IAP_ADDRH = my_unTemp16.un_temp8[0];    //…Ë÷√ƒø±Íµ•‘™µÿ÷∑µƒ∏ﬂ8 Œªµÿ÷∑
 396   1              IAP_ADDRL = my_unTemp16.un_temp8[1];    //…Ë÷√ƒø±Íµ•‘™µÿ÷∑µƒµÕ8 Œªµÿ÷∑
 397   1              IAP_DATA = ch;                  //“™±‡≥Ãµƒ ˝æ›œ»ÀÕΩ¯IAP_DATA ºƒ¥Ê∆˜
 398   1              //EA = 0;
 399   1              IAP_TRIG = 0x46;   //   46???   œ»ÀÕ 5Ah,‘ŸÀÕA5h µΩISP/IAP ¥•∑¢ºƒ¥Ê∆˜,√ø¥Œ∂º–Ë»Á¥À
 400   1              IAP_TRIG = 0xB9;   //   B9???   ÀÕÕÍA5h ∫Û£¨ISP/IAP √¸¡Ó¡¢º¥±ª¥•∑¢∆∂Ø
 401   1          _nop_();
 402   1              //EA = 1;
 403   1      }
 404          
 405          
 406          void EEPROM_erase(unsigned int add)//≤¡≥˝…»«¯, »Îø⁄:DPTR = …»«¯µÿ÷∑
 407          {
 408   1              IAP_CMD = 0x03;                 //IAP/ISP/EEPROM …»«¯≤¡≥˝√¸¡Ó
 409   1          my_unTemp16.un_temp16 = add;
 410   1          IAP_ADDRH = my_unTemp16.un_temp8[0];    //…Ë÷√ƒø±Íµ•‘™µÿ÷∑µƒ∏ﬂ8 Œªµÿ÷∑
 411   1          IAP_ADDRL = my_unTemp16.un_temp8[1];    //…Ë÷√ƒø±Íµ•‘™µÿ÷∑µƒµÕ8 Œªµÿ÷∑
 412   1      
 413   1          //EA = 0;
 414   1          IAP_TRIG = 0x46;   //   46???   œ»ÀÕ 5Ah,‘ŸÀÕA5h µΩISP/IAP ¥•∑¢ºƒ¥Ê∆˜,√ø¥Œ∂º–Ë»Á¥À
 415   1          IAP_TRIG = 0xB9;   //   B9???   ÀÕÕÍA5h ∫Û£¨ISP/IAP √¸¡Ó¡¢º¥±ª¥•∑¢∆∂Ø
 416   1          _nop_();
 417   1          //EA = 1;
 418   1      }
 419          
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 8   

 420          void EEPROM_IAP_Disable()
 421          {
 422   1          //πÿ±’IAP π¶ƒ‹, «Âœ‡πÿµƒÃÿ ‚π¶ƒ‹ºƒ¥Ê∆˜, πCPU ¥¶”⁄∞≤»´◊¥Ã¨
 423   1          //“ª¥Œ¡¨–¯µƒIAP ≤Ÿ◊˜ÕÍ≥…÷Æ∫ÛΩ®“Èπÿ±’IAP π¶ƒ‹,≤ª–Ë“™√ø¥Œ∂ºπÿ
 424   1              IAP_CONTR = 0;      //πÿ±’IAP π¶ƒ‹
 425   1              IAP_CMD   = 0;      //«Â√¸¡Óºƒ¥Ê∆˜, π√¸¡Óºƒ¥Ê∆˜Œﬁ√¸¡Ó,¥Àæ‰ø…≤ª”√
 426   1              IAP_TRIG = 0;      //«Â√¸¡Ó¥•∑¢ºƒ¥Ê∆˜, π√¸¡Ó¥•∑¢ºƒ¥Ê∆˜Œﬁ¥•∑¢,¥Àæ‰ø…≤ª”√
 427   1              IAP_ADDRH = 0;
 428   1              IAP_ADDRL = 0;
 429   1      }
 430          
 431          void send(unsigned char str[])
 432          {
 433   1              unsigned int i=0;
 434   1              while(str[i]!='\0')
 435   1              {
 436   2                      SBUF=str[i];
 437   2                      while(!TI);
 438   2                      TI=0;
 439   2                      i++;
 440   2              }
 441   1      }
 442          
 443          void New_Temprature(void){
 444   1      
 445   1      Model4_WTemprature[0]=eeprom_meanvalue1;//∞ŸŒª
 446   1      Model4_WTemprature[1]=eeprom_meanvalue2;// ÆŒª
 447   1      Model4_WTemprature[2]=eeprom_meanvalue3;//∏ˆŒª
 448   1      
 449   1      }
 450          
 451          
 452          void Model4_Save_Data(void){
 453   1      
 454   1              uchar M4_Wi;
 455   1              uint M4_Wj=0,disc=0;
 456   1      /*if(allow_erase==0){   
 457   1              for(disc=0;disc<8;disc++){
 458   1              Mainaddress=0x2000+disc*0x200;
 459   1              EEPROM_erase(Mainaddress);
 460   1              disc++;
 461   1              }
 462   1              EEPROM_IAP_Disable();
 463   1              allow_erase=1;
 464   1      }
 465   1              
 466   1          if(Model4_WTemprature[0]==0x30)        //∏ﬂŒªŒ™0£¨≤ªœ‘ æ
 467   1         {
 468   1           Model4_WTemprature[0]=0x20 ;
 469   1           if(Model4_WTemprature[1]==0x30)      //¥Œ∏ﬂŒªŒ™0£¨≤ªœ‘ æ
 470   1           Model4_WTemprature[1]=0x20 ;
 471   1         }
 472   1      
 473   1      */
 474   1      
 475   1              if(Model4_Eeprom_Counter<=0x2fff){
 476   2                              New_Temprature();
 477   2                                      IAP_CONTR = ENABLE_ISP; 
 478   2                              for(M4_Wi=0;M4_Wi<=2;M4_Wi++){
 479   3                                      EEPROM_write(Model4_Eeprom_Counter,Model4_WTemprature[M4_Wi]);
 480   3      //                              EEPROM_write(Model4_Eeprom_Counter,'\x2a');
 481   3                                      Model4_Eeprom_Counter++;
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 9   

 482   3                                      M4_Wj++;
 483   3                              }       
 484   2              }
 485   1      
 486   1      else {M4_Wj=0;}
 487   1      
 488   1      //if((M4_Wj%509)==1){disc=(0x2000+((M4_Wj/511)+2)*0x200+256);EEPROM_erase(disc);}
 489   1      
 490   1      EEPROM_IAP_Disable(); //πÿ±’IAP π¶ƒ‹, «Âœ‡πÿµƒÃÿ ‚π¶ƒ‹ºƒ¥Ê∆˜, πCPU ¥¶”⁄∞≤»´◊¥Ã¨
 491   1      }
 492          
 493          
 494          
 495          
 496          void Model4_Send_Data(void){
 497   1      
 498   1              uchar M4_Si;//M4_Sj;
 499   1              if((Model4_SendFlag1==0)&&(Model4_SendData_Counter<0x2fff)){
 500   2                      IAP_CONTR = ENABLE_ISP;         //¥Úø™IAP π¶ƒ‹, …Ë÷√Flash ≤Ÿ◊˜µ»¥˝ ±º‰
 501   2                      for(M4_Si=0;M4_Si<=2;M4_Si++){
 502   3                              Model4_STemprature[M4_Si]=EEPROM_read(Model4_SendData_Counter);
 503   3                              Model4_SendData_Counter++;
 504   3                      //      M4_Si++;
 505   3                                      
 506   3                      }
 507   2              Model4_STemprature[3]='\0';
 508   2              send(Model4_STemprature);
 509   2              send("\x20");
 510   2      //      Model4_rkey=Model4_KeyScan();
 511   2                      EEPROM_IAP_Disable();
 512   2              }
 513   1      
 514   1      else if(Model4_SendFlag1==0){Model4_SendFlag1=1;send("Sanding Over");}
 515   1      
 516   1      
 517   1      
 518   1      
 519   1      //send("Send Over");
 520   1                      }
 521          
 522          
 523          /**************************************************************/
 524          /**************************************************************/
 525          /**************************************************************/
 526          /**************************************************************/
 527          /**************************************************************/
 528          
 529          void main(void){
 530   1      
 531   1      /*************º”»ÎµÁª˙2******************/
 532   1      Speaker=1;
 533   1      P3_2=1;
 534   1      
 535   1      T1_init();
 536   1      
 537   1      /***********eepromº”»Îµƒµ⁄»˝≤ø∑÷*****/
 538   1      
 539   1         SCON=0x50;//¥Æø⁄∑Ω Ω1£¨‘ –ÌΩ” ’
 540   1         TMOD=0x21;//∂® ±∆˜1£¨∂® ±∑Ω Ω2
 541   1      // TCON=0x40;//…Ë∂® ±∆˜1ø™ ºº∆ ˝
 542   1              TH1=0xE8;//11.0592MHz, 1200≤®Ãÿ¬ 
 543   1         TL1=0xE8;
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 10  

 544   1         TI=1;
 545   1         TR1=1;
 546   1      
 547   1                      IAP_CONTR = ENABLE_ISP;
 548   1      
 549   1         for(Cleaner=0;Cleaner<8;Cleaner++){
 550   2              Mainaddress=0x2000+Cleaner*0x200;
 551   2              EEPROM_erase(Mainaddress);
 552   2      //      Cleaner++;
 553   2              }
 554   1      
 555   1              EEPROM_IAP_Disable();
 556   1      /***********************************/
 557   1      
 558   1      count = 0;
 559   1      step_index = 0;
 560   1      spcount = 0;
 561   1      stop_flag = 0;
 562   1      
 563   1      P1_0 = 0;
 564   1      P1_1 = 0;
 565   1      P1_2 = 0;
 566   1      P1_3 = 0;
 567   1      
 568   1      IT1=1;
 569   1      PX1=1;
 570   1      EX1=1;
 571   1      EA = 1;            //‘ –ÌCPU÷–∂œ 
 572   1      TMOD = 0x21; //…Ë∂® ±∆˜0∫Õ1Œ™16Œªƒ£ Ω1°¢2
 573   1      ET0 = 1;           //∂® ±∆˜0÷–∂œ‘ –Ì 
 574   1      
 575   1      TH0 = 0xFE;
 576   1      TL0 = 0x0C;   //…Ë∂® ±√ø∏Ù0.5ms÷–∂œ“ª¥Œ
 577   1      
 578   1      /***************************************/
 579   1      
 580   1      
 581   1              PT2272_Data0=1;
 582   1              PT2272_Data1=1;
 583   1              PT2272_Data2=1;
 584   1              PT2272_Data3=1;
 585   1      
 586   1      while(1){
 587   2      
 588   2      if((T1_h<=7)||(T1_h>=19)){      Motor_CloseDown();Base_Flag=1;}
 589   2      else Base_Flag=0;
 590   2      
 591   2      
 592   2              if      ((SelfControl_Flag==0)&&(Base_Flag==0)){ MainModel1(); }
 593   2              else     {  MainModel2();}
 594   2      
 595   2                        }
 596   1      
 597   1                        
 598   1                        
 599   1                        
 600   1                        
 601   1                        
 602   1                        
 603   1                        
 604   1      }
 605          
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 11  

 606          
 607          /**********************************************º”»Îµƒµ⁄“ª≤ø∑÷*********************************************
             -********************************/
 608          
 609          void MainModel1(void){ 
 610   1      
 611   1      Speaker=1;
 612   1      P3_2=1;
 613   1      
 614   1      while(1) {   
 615   2              adc1_display();                 
 616   2              adc2_display();
 617   2      
 618   2      
 619   2      if               (Motor_StepCounter>=45){LED6_=0;LED7_=1;}
 620   2      else if(Motor_StepCounter<=0){LED6_=1;LED7_=0;}
 621   2      else   {LED6_=1;LED7_=1;}
 622   2      
 623   2      meanvalue1=((char)((display1_[1]-0x30+display2_[1]-0x30)/2)+0x30);
 624   2      meanvalue2=(display2_[2]-0x30+display1_[2]-0x30+0x30);
 625   2      
 626   2      /***************************eeprom≤ø∑÷******************************************************/
 627   2      
 628   2      eeprom_meanvalue1=((char)((display1_[2]-0x30+display2_[2]-0x30)/2)+0x30);
 629   2      eeprom_meanvalue2=meanvalue1;
 630   2      eeprom_meanvalue3=((char)((display1_[0]-0x30+display2_[0]-0x30)/2)+0x30);
 631   2      
 632   2      Model4_Save_Data();
 633   2      Model4_Send_Data();
 634   2      //send("Send Over");
 635   2      
 636   2      /*******************************************************************************************/
 637   2      
 638   2      if(meanvalue2>=0x31){Motor_StepCounter--;
 639   3      stop_flag=0;if(Motor_StepCounter<=0){stop_flag=1;}
 640   3      LED5_=1;LED4_=~LED4_;delay1(100);
 641   3      Motor_CompSlowlyUp();}
 642   2      
 643   2      else if(meanvalue1>=0x39){Motor_StepCounter--;
 644   3      stop_flag=0;
 645   3      if(Motor_StepCounter<=0){stop_flag=1;}
 646   3      LED5_=1;LED4_=~LED4_;delay1(100);
 647   3      Motor_CompSlowlyUp();}
 648   2      
 649   2      else if(meanvalue1>=0x35){LED4_=0;LED5_=0;delay1(100);}
 650   2      
 651   2      else   {Motor_StepCounter++;
 652   3      stop_flag=0;
 653   3      if(Motor_StepCounter>=45){stop_flag=1;}
 654   3      LED4_=1;LED5_=~LED5_;delay1(100);
 655   3      Motor_CompSlowlyDown();}
 656   2      
 657   2      if(P3_2==0){Speaker=0;}
 658   2      else if(P3_2==1){Speaker=1;}
 659   2      
 660   2      if(SelfControl_Flag==1)break;
 661   2               }
 662   1      
 663   1      }
 664          
 665          /*************************º”»Îµƒµ⁄“ª≤ø∑÷Ω· ¯**********************************/
 666          
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 12  

 667          void MainModel2(void){
 668   1      
 669   1      Speaker=1;
 670   1      P3_2=1;
 671   1      stop_flag=0;
 672   1      
 673   1              while(1){
 674   2              PT2272_Data0=1;
 675   2              PT2272_Data1=1;
 676   2              PT2272_Data2=1;
 677   2              PT2272_Data3=1;
 678   2      
 679   2              
 680   2      if         (Motor_StepCounter>=45){LED6_=0;LED7_=1;}
 681   2      else if(Motor_StepCounter<=0){LED6_=1;LED7_=0;}
 682   2      else   {LED6_=1;LED7_=1;}
 683   2      
 684   2      
 685   2              if(Check_ForOnce==0){
 686   3      
 687   3                              if               ((PT2272_Data0==1)&&(PT2272_Data1==0)&&(PT2272_Data2==0)&&(PT2272_Data3==0))
 688   3                                               {SignalControl_Flag1=0;
 689   4                                               SignalControl_Flag2=1;
 690   4                                               }
 691   3      
 692   3                              else if((PT2272_Data0==0)&&(PT2272_Data1==0)&&(PT2272_Data2==1)&&(PT2272_Data3==0))
 693   3                                               {SignalControl_Flag1=0;
 694   4                                               SignalControl_Flag2=1;
 695   4                                               }
 696   3      
 697   3                              else if((PT2272_Data0==1)&&(PT2272_Data1==1)&&(PT2272_Data2==1)&&(PT2272_Data3==0))
 698   3                                               {SignalControl_Flag2=0;
 699   4                                               SignalControl_Flag1=1;
 700   4                                               }
 701   3      
 702   3                              else if((PT2272_Data0==0)&&(PT2272_Data1==1)&&(PT2272_Data2==1)&&(PT2272_Data3==0))
 703   3                                               {SignalControl_Flag2=0;
 704   4                                               SignalControl_Flag1=1;
 705   4                                               }
 706   3      
 707   3                              else if((PT2272_Data0==1)&&(PT2272_Data1==1)&&(PT2272_Data2==0)&&(PT2272_Data3==0))
 708   3                                               {SignalControl_Flag2=0;
 709   4                                               SignalControl_Flag1=1;
 710   4                                               }
 711   3      
 712   3                              else if((PT2272_Data0==0)&&(PT2272_Data1==1)&&(PT2272_Data2==0)&&(PT2272_Data3==0))
 713   3                                               {SignalControl_Flag2=0;
 714   4                                               SignalControl_Flag1=1;
 715   4                                               }
 716   3      
 717   3                              else if((PT2272_Data0==0)&&(PT2272_Data1==0)&&(PT2272_Data2==0)&&(PT2272_Data3==0))
 718   3                                               {SignalControl_Flag2=0;
 719   4                                               SignalControl_Flag1=1;
 720   4                                               }
 721   3              
 722   3              Check_ForOnce=1;}
 723   2              /****************************************************************************************************/  
 724   2      
 725   2                              if               ((SignalControl_Flag1==0)&&((PT2272_Data0==1)&&(PT2272_Data1==0)&&(PT2272_Data2==0)&&(PT2272_Data3
             -==0)))
 726   2                                               {if(Motor_StepCounter<=0)SignalControl_Flag1=1;
 727   3                                                else SignalControl_Flag1=0;
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 13  

 728   3                                               Motor_CompSlowlyUp();
 729   3                                               Motor_StepCounter--;
 730   3                                               
 731   3                                               }
 732   2      
 733   2                              else if((SignalControl_Flag1==0)&&((PT2272_Data0==0)&&(PT2272_Data1==0)&&(PT2272_Data2==1)&&(PT2272_Dat
             -a3==0)))
 734   2                                               {if(Motor_StepCounter>=45)SignalControl_Flag1=1;
 735   3                                                else SignalControl_Flag1=0;
 736   3                                               Motor_CompSlowlyDown();
 737   3                                               Motor_StepCounter++;
 738   3                                               }
 739   2      
 740   2                              else if((SignalControl_Flag2==0)&&((PT2272_Data0==1)&&(PT2272_Data1==1)&&(PT2272_Data2==1)&&(PT2272_Da
             -ta3==0)))
 741   2                                               {Motor_OpenUp();
 742   3                                               SignalControl_Flag2=1;
 743   3                                               }
 744   2      
 745   2                              else if((SignalControl_Flag2==0)&&((PT2272_Data0==0)&&(PT2272_Data1==1)&&(PT2272_Data2==1)&&(PT2272_Dat
             -a3==0)))
 746   2                                               {Motor_CloseDown();
 747   3                                               SignalControl_Flag2=1;
 748   3                                               }
 749   2      
 750   2                              else if((SignalControl_Flag2==0)&&((PT2272_Data0==1)&&(PT2272_Data1==1)&&(PT2272_Data2==0)&&(PT2272_Dat
             -a3==0)))
 751   2                                               {Motor_CompSlowlyUp();
 752   3                                               Motor_StepCounter--;
 753   3                                               SignalControl_Flag2=1;
 754   3                                               }
 755   2      
 756   2                              else if((SignalControl_Flag2==0)&&((PT2272_Data0==0)&&(PT2272_Data1==1)&&(PT2272_Data2==0)&&(PT2272_Dat
             -a3==0)))
 757   2                                               {Motor_CompSlowlyDown();
 758   3                                               Motor_StepCounter++;
 759   3                                               SignalControl_Flag2=1;
 760   3                                               }
 761   2      
 762   2      if(P3_2==0){Speaker=0;}
 763   2      else if(P3_2==1){Speaker=1;}
 764   2      
 765   2      
 766   2              delay1(100);
 767   2              if(SelfControl_Flag==0)break;
 768   2              
 769   2              }
 770   1      
 771   1      }
 772          
 773          
 774          void SelfControl_int(void) interrupt 2
 775          {
 776   1              delay1(100);
 777   1              Check_ForOnce=0;
 778   1              if((PT2272_Data0==0)&&(PT2272_Data1==0)&&(PT2272_Data2==0)&&(PT2272_Data3==1))
 779   1                              {SelfControl_Flag=0;}
 780   1              else if((PT2272_Data0==0)&&(PT2272_Data1==0)&&(PT2272_Data2==1)&&(PT2272_Data3==1))
 781   1                              {SelfControl_Flag=1;}
 782   1                              
 783   1                              /*      
 784   1                      INT1_Counter++;
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 14  

 785   1                      if(INT1_Counter==5)INT1_Counter=1;      
 786   1              }
 787   1      if((INT1_Counter%2)==1){SelfControl_Flag=1;}
 788   1      else SelfControl_Flag=0;
 789   1      */
 790   1      }
 791          
 792          /***************************************“‘œ¬º”»ÎµÁª˙≥Ã–Ú*******************************************/
 793          
 794          void Motor_CloseDown(void){
 795   1      turn=1;
 796   1      while(Motor_StepCounter<=45){
 797   2      turn=1;
 798   2              Motor_CompSlowlyDown();
 799   2              Motor_StepCounter++;
 800   2      
 801   2      if         (Motor_StepCounter>=45){LED6_=0;LED7_=1;}
 802   2      else if(Motor_StepCounter<=0){LED6_=1;LED7_=0;}
 803   2      else   {LED6_=1;LED7_=1;}
 804   2      
 805   2      }
 806   1      
 807   1      }
 808          
 809          
 810          /*****************************************************************************************************/
 811          
 812          void Motor_OpenUp(void){
 813   1      turn=0;
 814   1      while(Motor_StepCounter>=0){
 815   2      turn=0;
 816   2              Motor_CompSlowlyUp();
 817   2              Motor_StepCounter--;
 818   2      
 819   2      if         (Motor_StepCounter>=45){LED6_=0;LED7_=1;}
 820   2      else if(Motor_StepCounter<=0){LED6_=1;LED7_=0;}
 821   2      else   {LED6_=1;LED7_=1;}
 822   2      
 823   2      }
 824   1      
 825   1      }
 826          
 827          
 828          /*****************************************************************************************************/
 829          
 830          void Motor_CompSlowlyDown(void){
 831   1      turn=1;
 832   1      spcount=0;
 833   1          speedlevel=2;
 834   1               for(i=0;i<=31;i++)
 835   1                      for(j=0;j<=15;j++){HadBeenDone=0;TH0=0xFE;TL0=0x0c;TR0=1;delay(2);
 836   2                      if(HadBeenDone==1){
 837   3                      if(spcount<=0){spcount=speedlevel;
 838   4                      gorun();}}}
 839   1                      TR0=0;
 840   1      }
 841          
 842          
 843          /**************************************************************************************************/
 844          
 845          void Motor_CompSlowlyUp(void){
 846   1      turn=0;
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 15  

 847   1      spcount=0;
 848   1          speedlevel=2;
 849   1               for(i=0;i<=31;i++)
 850   1                      for(j=0;j<=15;j++){HadBeenDone=0;TH0=0xFE;TL0=0x0c;TR0=1;delay(2);
 851   2                      if(HadBeenDone==1){
 852   3                      if(spcount<=0){spcount=speedlevel;
 853   4                      gorun();}}}
 854   1                      TR0=0;
 855   1      }
 856          
 857          
 858          
 859          
 860          /*************************************************************************************/
 861          
 862          /*************************∂® ±∆˜1µƒ÷–∂œ**********************
 863          void Time0() interrupt 3  
 864          {
 865            TH1=0x94;
 866            TL1=0x00;
 867            T1_counter++;
 868            if(T1_counter==20)
 869            {
 870              T1_s++;
 871            T1_counter=0;
 872            if(T1_s==60)
 873            { 
 874              T1_m++;
 875              T1_s=0;
 876                if(T1_m==60)
 877              {
 878                T1_h++;
 879              T1_m=0;
 880              if(T1_h==24)
 881               T1_h=0;
 882                   }
 883                 }
 884          
 885            }
 886          }
 887          
 888          */
 889          /****************∂® ±∆˜0÷–∂œ¥¶¿Ì*****************************/ 
 890          void timeint(void) interrupt 1 
 891          { 
 892   1      TH0=0xFE;
 893   1      TL0=0x0C; //…Ë∂® ±√ø∏Ù0.5ms÷–∂œ“ª¥Œ
 894   1      
 895   1      
 896   1      count++;
 897   1      if(HadBeenDone==0){HadBeenDone=1;
 898   2      spcount--;
 899   2      }
 900   1      
 901   1      }
 902          
 903          void delay(unsigned int endcount)
 904          {
 905   1      count=0;
 906   1      do{}while(count<endcount);
 907   1      }
 908          
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 16  

 909          void gorun()
 910          {
 911   1      if (stop_flag==1)
 912   1      {
 913   2          P1_0 = 0;
 914   2          P1_1 = 0;
 915   2          P1_2 = 0;
 916   2          P1_3 = 0;
 917   2          return;
 918   2      }
 919   1      
 920   1      switch(step_index)
 921   1      {
 922   2      case 0: //0
 923   2          P1_0 = 1;
 924   2          P1_1 = 0;
 925   2          P1_2 = 0;
 926   2          P1_3 = 0;
 927   2          break;
 928   2      case 1: //0°¢1
 929   2          P1_0 = 1;
 930   2          P1_1 = 1;
 931   2          P1_2 = 0;
 932   2          P1_3 = 0;
 933   2          break;
 934   2      case 2: //1
 935   2          P1_0 = 0;
 936   2          P1_1 = 1;
 937   2          P1_2 = 0;
 938   2          P1_3 = 0;
 939   2          break;
 940   2      case 3: //1°¢2
 941   2          P1_0 = 0;
 942   2          P1_1 = 1;
 943   2          P1_2 = 1;
 944   2          P1_3 = 0;
 945   2          break;
 946   2      case 4: //2
 947   2          P1_0 = 0;
 948   2          P1_1 = 0;
 949   2          P1_2 = 1;
 950   2          P1_3 = 0;
 951   2          break;
 952   2      case 5: //2°¢3
 953   2          P1_0 = 0;
 954   2          P1_1 = 0;
 955   2          P1_2 = 1;
 956   2          P1_3 = 1;
 957   2          break;
 958   2      case 6: //3
 959   2          P1_0 = 0;
 960   2          P1_1 = 0;
 961   2          P1_2 = 0;
 962   2          P1_3 = 1;
 963   2          break;
 964   2      case 7: //3°¢0
 965   2          P1_0 = 1;
 966   2          P1_1 = 0;
 967   2          P1_2 = 0;
 968   2          P1_3 = 1;
 969   2      }
 970   1      
C51 COMPILER V7.00  º__ÎEEPROM__“∂¥__€_____Ú                                               11/12/2009 18:33:14 PAGE 17  

 971   1      if (turn==0)
 972   1      {
 973   2          step_index++;
 974   2          if (step_index>7)
 975   2            step_index=0;
 976   2      }
 977   1      else
 978   1      {
 979   2          step_index--;
 980   2          if (step_index<0)
 981   2            step_index=7;
 982   2      }
 983   1          
 984   1      }
 985          
 986          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2164    ----
   CONSTANT SIZE    =     31    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     56       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =     10    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
